<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Fancy Flask Extended</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <header class="topbar">
    <div class="controls">
      <label for="trackSelect">Wähle Musik:</label>
      <select id="trackSelect">
        <option value="Lowtone Music - Chill Calm.mp3">🎵 Chill Calm (1)</option>
        <option value="Lowtone Music - Chill Journey.mp3">🎶 Chill Journey (2)</option>
        <option value="snoozy beats - night chill.mp3">🎧 Night Chill (3)</option>
      </select>

      <label for="volume">🔊</label>
      <input type="range" id="volume" min="0" max="1" step="0.01" value="0.5">
      <button id="muteBtn">🔇 Mute</button>
      <button id="colorBtn">🎨 Farbwechsel</button>
      <button id="toggleThemeBtn">🌓 Dark/Light Mode</button>
    </div>

    {% if name %}
      <h2>👋 Willkommen, {{ name }}!</h2>
    {% else %}
      <form method="post" id="nameForm">
        <input type="text" name="name" placeholder="Wie heißt du?" required>
        <button type="submit">Sag Hallo</button>
      </form>
    {% endif %}

    <p class="slogan" id="quoteDisplay">„Glaube an Wunder, Liebe und Glück!“</p>
    <p id="visitorDisplay">👁️ Besucher: <span id="visitorCount">{{ visitor_count }}</span></p>
  </header>

  <audio id="bgMusic" autoplay loop>
    <source src="{{ url_for('static', filename='Lowtone Music - Chill Calm.mp3') }}" type="audio/mp3">
  </audio>

  <script>
    // Zitate aus JSON laden
    const quoteDisplay = document.getElementById("quoteDisplay");
    async function loadQuotes() {
      try {
        const response = await fetch("/static/quotes.json");
        const quotes = await response.json();
        function rotateQuotes() {
          quoteDisplay.style.opacity = 0;
          setTimeout(() => {
            const index = Math.floor(Math.random() * quotes.length);
            quoteDisplay.textContent = quotes[index];
            quoteDisplay.style.opacity = 1;
          }, 500);
        }
        rotateQuotes();
        setInterval(rotateQuotes, 8000);
      } catch (error) {
        quoteDisplay.textContent = "Zitat konnte nicht geladen werden.";
        console.error(error);
      }
    }
    loadQuotes();

    // Dark/Light Theme
    const toggleThemeBtn = document.getElementById("toggleThemeBtn");
    function setTheme(theme) {
      document.body.dataset.theme = theme;
      localStorage.setItem("theme", theme);
    }
    toggleThemeBtn.addEventListener("click", () => {
      const current = document.body.dataset.theme || "light";
      setTheme(current === "light" ? "dark" : "light");
    });
    const savedTheme = localStorage.getItem("theme") || "light";
    setTheme(savedTheme);

    // Musiksteuerung
    const bgMusic = document.getElementById('bgMusic');
    const trackSelect = document.getElementById('trackSelect');
    const volume = document.getElementById('volume');
    const muteBtn = document.getElementById('muteBtn');

    document.body.addEventListener('click', () => {
      bgMusic.play().catch(() => {});
    }, { once: true });

    trackSelect.addEventListener('change', () => {
      const file = trackSelect.value;
      bgMusic.src = `/static/${file}`;
      bgMusic.play();
    });

    volume.addEventListener('input', () => {
      bgMusic.volume = volume.value;
    });

    muteBtn.addEventListener('click', () => {
      bgMusic.muted = !bgMusic.muted;
      muteBtn.textContent = bgMusic.muted ? '🔈 Unmute' : '🔇 Mute';
    });

    // Farbwechsel
    const colorBtn = document.getElementById("colorBtn");
    const gradients = [
      "linear-gradient(to right, #FFDEE9, #B5FFFC)",
      "linear-gradient(to right, #D5FFD0, #FDCB82)",
      "linear-gradient(to right, #C9FFBF, #FBD3E9)",
      "linear-gradient(to right, #A1C4FD, #C2FFD8)"
    ];
    colorBtn.addEventListener("click", () => {
      const index = Math.floor(Math.random() * gradients.length);
      document.body.style.background = gradients[index];
    });
  </script>
</body>
</html>
